LIBGLIB2_DEPENDENCIES = host-pkg-config host-libglib2 zlib $(if $(BR2_NEEDS_GETTEXT),gettext libintl)

HOST_LIBGLIB2_DEPENDENCIES = host-pkg-config host-zlib

ifneq ($(BR2_ENABLE_LOCALE),y)
LIBGLIB2_DEPENDENCIES+=libiconv
endif

ifeq ($(BR2_PACKAGE_LIBICONV),y)
LIBGLIB2_CONF_OPT += --with-libiconv=gnu
LIBGLIB2_DEPENDENCIES+=libiconv
endif

define LIBGLIB2_REMOVE_DEV_FILES
        rm -rf $(TARGET_DIR)/usr/lib/glib-2.0
        rm -rf $(TARGET_DIR)/usr/share/glib-2.0/gettext
        rmdir --ignore-fail-on-non-empty $(TARGET_DIR)/usr/share/glib-2.0
        rm -f $(addprefix $(TARGET_DIR)/usr/bin/,glib-genmarshal glib-gettextize glib-mkenums gobject-query gtester gtester-report)
endef

ifneq ($(BR2_HAVE_DEVFILES),y)
LIBGLIB2_POST_INSTALL_TARGET_HOOKS += LIBGLIB2_REMOVE_DEV_FILES
endif

define LIBGLIB2_REMOVE_GDB_FILES
        rm -rf $(TARGET_DIR)/usr/share/glib-2.0/gdb
        rmdir --ignore-fail-on-non-empty $(TARGET_DIR)/usr/share/glib-2.0
endef

ifneq ($(BR2_PACKAGE_GDB),y)
LIBGLIB2_POST_INSTALL_TARGET_HOOKS += LIBGLIB2_REMOVE_GDB_FILES
endif

$(eval $(call AUTOTARGETS,package,libglib2))
$(eval $(call AUTOTARGETS,package,libglib2,host))

LIBGLIB2_HOST_BINARY:=$(HOST_DIR)/usr/bin/glib-genmarshal

